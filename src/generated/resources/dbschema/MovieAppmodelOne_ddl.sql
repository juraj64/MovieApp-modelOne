-- ###########################################
-- # Drop
-- ###########################################
-- Drop index

-- Drop many to many relations
DROP TABLE ACTOR_MOVIE CASCADE;

-- Drop normal entities
DROP TABLE MOVIE CASCADE;
DROP TABLE DIRECTOR CASCADE;
DROP TABLE ACTOR CASCADE;

-- Drop pk sequence
DROP SEQUENCE hibernate_sequence;

-- ###########################################
-- # Create
-- ###########################################
-- Create pk sequence
CREATE SEQUENCE hibernate_sequence;

-- Create normal entities
CREATE TABLE ACTOR (
	ID BIGINT NOT NULL,
	FIRSTNAME VARCHAR(100) NOT NULL,
	LASTNAME VARCHAR(100) NOT NULL,
	DATEOFBIRTH TIMESTAMP NOT NULL,
	UUID VARCHAR(36) NOT NULL,
	GENDER VARCHAR(1),
	CREATEDDATE TIMESTAMP,
	CREATEDBY VARCHAR(50),
	LASTUPDATED TIMESTAMP,
	LASTUPDATEDBY VARCHAR(50),
	VERSION BIGINT NOT NULL
);

CREATE TABLE DIRECTOR (
	ID BIGINT NOT NULL,
	FIRSTNAME VARCHAR(100) NOT NULL,
	LASTNAME VARCHAR(100) NOT NULL,
	DATEOFBIRTH TIMESTAMP NOT NULL,
	NATIONALITY VARCHAR(100) NOT NULL,
	UUID VARCHAR(36) NOT NULL,
	CREATEDDATE TIMESTAMP,
	CREATEDBY VARCHAR(50),
	LASTUPDATED TIMESTAMP,
	LASTUPDATEDBY VARCHAR(50),
	VERSION BIGINT NOT NULL
);

CREATE TABLE MOVIE (
	ID BIGINT NOT NULL,
	MOVIENAME VARCHAR(100) NOT NULL,
	MOVIELENGTH INTEGER NOT NULL,
	MOVIELANG VARCHAR(100) NOT NULL,
	RELEASEDATE TIMESTAMP NOT NULL,
	AGECERTIFICATE VARCHAR(100) NOT NULL,
	DOMESTICTAKINGS INTEGER NOT NULL,
	INTERNATIONALTAKINGS INTEGER NOT NULL,
	UUID VARCHAR(36) NOT NULL,
	DIRECTOR BIGINT NOT NULL,
	CREATEDDATE TIMESTAMP,
	CREATEDBY VARCHAR(50),
	LASTUPDATED TIMESTAMP,
	LASTUPDATEDBY VARCHAR(50),
	VERSION BIGINT NOT NULL
);


-- Create many to many relations
CREATE TABLE ACTOR_MOVIE (
	ACTOR BIGINT NOT NULL,
	MOVIE BIGINT NOT NULL
);


-- Primary keys
ALTER TABLE ACTOR ADD CONSTRAINT PK_ACTOR
	PRIMARY KEY (ID);
ALTER TABLE DIRECTOR ADD CONSTRAINT PK_DIRECTOR
	PRIMARY KEY (ID);
ALTER TABLE MOVIE ADD CONSTRAINT PK_MOVIE
	PRIMARY KEY (ID);
ALTER TABLE ACTOR_MOVIE ADD CONSTRAINT PK_ACTOR_MOVIE
	PRIMARY KEY (ACTOR, MOVIE);

-- Unique constraints
ALTER TABLE ACTOR
	ADD CONSTRAINT UQ_ACTOR UNIQUE (UUID);
ALTER TABLE DIRECTOR
	ADD CONSTRAINT UQ_DIRECTOR UNIQUE (UUID);
ALTER TABLE MOVIE
	ADD CONSTRAINT UQ_MOVIE UNIQUE (UUID);

-- Foreign key constraints


-- Reference from Movie.director to Director
ALTER TABLE MOVIE ADD CONSTRAINT FK_MOVIE_DIRECTOR
	FOREIGN KEY (DIRECTOR) REFERENCES DIRECTOR (ID);
CREATE INDEX IX_MOVIE_DIRECTOR ON MOVIE (DIRECTOR);

-- Reference from ACTOR_MOVIE.actor to Actor
ALTER TABLE ACTOR_MOVIE ADD CONSTRAINT FK_ACTOR_MOVIE_ACTOR
	FOREIGN KEY (ACTOR) REFERENCES ACTOR (ID);
CREATE INDEX IX_ACTOR_MOVIE_ACTOR ON ACTOR_MOVIE (ACTOR);

-- Reference from ACTOR_MOVIE.movie to Movie
ALTER TABLE ACTOR_MOVIE ADD CONSTRAINT FK_ACTOR_MOVIE_MOVIE
	FOREIGN KEY (MOVIE) REFERENCES MOVIE (ID);
CREATE INDEX IX_ACTOR_MOVIE_MOVIE ON ACTOR_MOVIE (MOVIE);

-- Index
